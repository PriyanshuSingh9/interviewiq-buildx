# Data Schemas

This file serves as the single source of truth for all structured data in InterviewIQ.

## 1. Database Tables (Drizzle ORM + Neon PostgreSQL)

All tables are defined in `lib/db/schema.js`.

### User
```sql
User (
  id        TEXT PRIMARY KEY DEFAULT gen_random_uuid(),
  clerkId   TEXT NOT NULL UNIQUE,
  name      TEXT NOT NULL,
  email     TEXT NOT NULL UNIQUE,
  githubProfile TEXT,
  createdAt TIMESTAMP DEFAULT NOW()
)
```

### InterviewPreset
Reusable configuration for interview sessions. Multiple sessions can share one preset.
```sql
InterviewPreset (
  id              TEXT PRIMARY KEY DEFAULT gen_random_uuid(),
  userId          TEXT NOT NULL → User.id,
  jobDescription  TEXT NOT NULL,
  resumeLocation  TEXT NOT NULL,
  resumeName      TEXT,
  githubUrl       TEXT,
  targetRole      TEXT NOT NULL,
  createdAt       TIMESTAMP DEFAULT NOW()
)
```

### InterviewSessions
Each session belongs to a preset and stores the AI-generated analysis + system prompt.
```sql
InterviewSessions (
  id                  TEXT PRIMARY KEY DEFAULT gen_random_uuid(),
  presetId            TEXT NOT NULL → InterviewPreset.id,
  audioLocation       TEXT,        -- nullable
  preInterviewReport  JSONB,       -- see Pre-Interview Report Schema below
  postInterviewReport JSONB,       -- see Post-Interview Report Schema
  systemPrompt        TEXT,
  transcript          JSONB,       -- array of transcript fragments
  createdAt           TIMESTAMP DEFAULT NOW()
)
```

### QuestionBank
Pre-seeded coding questions with role-based tagging. Currently 25 JavaScript questions (15 DSA, 10 bug-fix).
```sql
QuestionBank (
  id           TEXT PRIMARY KEY DEFAULT gen_random_uuid(),
  type         TEXT NOT NULL,       -- 'dsa' | 'bugfix'
  difficulty   TEXT NOT NULL,       -- 'easy' | 'medium' | 'hard'
  tags         JSONB NOT NULL,      -- ["arrays", "hashmap", ...]
  roleTags     JSONB NOT NULL,      -- ["sde", "backend", "fullstack", ...]
  title        TEXT NOT NULL,
  description  TEXT NOT NULL,
  starterCode  TEXT NOT NULL,       -- JavaScript only
  testCases    JSONB NOT NULL,      -- [{input, expectedOutput}]
  sampleIO     JSONB,              -- visible examples for the user
  idealSolution TEXT,
  createdAt    TIMESTAMP DEFAULT NOW()
)
```

### CodingRound
One coding round per interview session.
```sql
CodingRound (
  id              TEXT PRIMARY KEY DEFAULT gen_random_uuid(),
  sessionId       TEXT NOT NULL → InterviewSessions.id,
  status          TEXT NOT NULL DEFAULT 'pending',  -- 'pending' | 'in_progress' | 'completed'
  overallScore    INTEGER,
  overallFeedback TEXT,
  createdAt       TIMESTAMP DEFAULT NOW()
)
```

### CodingSubmission
One submission per question within a coding round.
```sql
CodingSubmission (
  id             TEXT PRIMARY KEY DEFAULT gen_random_uuid(),
  roundId        TEXT NOT NULL → CodingRound.id,
  questionId     TEXT NOT NULL → QuestionBank.id,
  questionNumber INTEGER NOT NULL,
  userCode       TEXT,
  testResults    JSONB,         -- [{input, expected, actual, passed}]
  testsPassed    INTEGER,
  testsTotal     INTEGER,
  aiScore        INTEGER,
  aiFeedback     JSONB,
  createdAt      TIMESTAMP DEFAULT NOW()
)
```

---

## 2. Pre-Interview Report Schema (JSONB in InterviewSessions.preInterviewReport)

Generated by `lib/pre-interview/reportGenerator.js` via Gemini 2.5 Flash.

```json
{
  "candidateSummary": {
    "name": "string",
    "currentRole": "string",
    "yearsExperience": "string",
    "topSkills": ["string"],
    "education": "string"
  },
  "fitAnalysis": {
    "fitScore": 85,
    "fitReasoning": "string — 2-3 sentences on overall fit",
    "matchedSkills": ["string"],
    "missingSkills": ["string"],
    "redFlags": ["string"]
  },
  "githubAssessment": {
    "overallComplexity": "production-grade | real-tool | learning-project",
    "hasTests": true,
    "hasInfraTooling": true,
    "infrastructureSignals": ["Docker", "CI/CD"],
    "repos": [
      {
        "name": "repo-name",
        "complexityRating": "production-grade | real-tool | learning-project",
        "keyTechnologies": ["tech1", "tech2"],
        "architecturalInsights": ["insight1"]
      }
    ]
  },
  "levelCalibration": {
    "appliedLevel": "string — e.g. Full-Stack Engineer",
    "evidenceLevel": "string — e.g. Junior",
    "calibrationNotes": "string — detailed reasoning"
  },
  "interviewPlan": {
    "rounds": [
      {
        "name": "Background & Experience",
        "durationMinutes": 5,
        "focus": "string"
      }
    ],
    "weakestAreaToProbe": "string"
  }
}
```

---

## 3. Post-Interview Report Schema (Planned — JSONB in InterviewSessions.postInterviewReport)

```json
{
  "overallScore": 85,
  "overallGrade": "A|B|C|D|F",
  "executiveSummary": "string",
  "dimensions": {
    "technicalDepth": { "score": 8, "assessment": "string" },
    "communicationClarity": { "score": 8, "assessment": "string" },
    "problemSolvingApproach": { "score": 8, "assessment": "string" },
    "projectOwnership": { "score": 8, "assessment": "string" },
    "pressureHandling": { "score": 8, "assessment": "string" }
  },
  "strengths": ["string"],
  "areasForImprovement": ["string"],
  "hiringRecommendation": "strong_yes|yes|maybe|no"
}
```

---

## 4. Coding Round Evaluation Schema (returned by /api/coding/evaluate)

```json
{
  "execution": {
    "passed": true,
    "testResults": [{ "input": "...", "expected": "...", "actual": "...", "passed": true }],
    "testsPassed": 3,
    "testsTotal": 4
  },
  "aiFeedback": {
    "score": 75,
    "codeQuality": "string — assessment of code quality",
    "edgeCases": "string — edge case handling",
    "suggestions": ["string"],
    "overallFeedback": "string"
  }
}
```
